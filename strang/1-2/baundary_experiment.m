% MATLABによる実験：差分方程式 T_n U = f および T_{n+1} V = g
clear; clc;

n_values = [3, 7, 15];

fprintf('------------------------------------------------------------\n');
fprintf('  n   |   e (片側差分 U)     |   E (中心差分 V)   \n');
fprintf('------------------------------------------------------------\n');

for n = n_values
    h = 1 / (n + 1);  % 区間幅
    c = (pi / 2)^2;   % f(0)
    
    % --- 共通：厳密解とソース項の準備 ---
    x = (1:n)' * h; 
    u_exact = cos(pi * x / 2);  % 真値
    f = c * u_exact;

    % ==========================================================
    % 1. 片側差分 (U) の計算：行列 T を使用
    % ==========================================================
    
    % 【改善点】教科書流の書き方
    % まずサイズ n の行列 K を作る (toeplitz使用)
    K = toeplitz([2 -1 zeros(1, n-2)]);
    
    % K の左上(1,1)を 1 に変更すると T になる (画像1枚目参照)
    T = K; 
    T(1, 1) = 1; 
    
    % 計算実行
    U = h^2 * (T \ f);
    e = 1 - U(1);  % Uの誤差

    % ==========================================================
    % 2. 中心差分 (V) の計算：サイズ n+1 の行列を使用
    % ==========================================================
    
    % 右辺ベクトル g の準備
    g = [c/2; f];
    
    % V用の行列は、サイズが n+1 であること以外は T と同じ構造
    % (左端条件の処理により、左上が1になるため)
    m = n + 1;
    K_large = toeplitz([2 -1 zeros(1, m-2)]);
    T_large = K_large;
    T_large(1, 1) = 1;
    
    % 計算実行
    V = h^2 * (T_large \ g);
    E = 1 - V(1);  % Vの誤差

    % ==========================================================
    % 結果表示
    % ==========================================================
    fprintf('  %2d  |   %.5f           |   %.5f\n', n, e, E);
end
fprintf('------------------------------------------------------------\n');
